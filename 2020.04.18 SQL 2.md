# SQL
  
 ### 4. 식별자  
   
 1. 식별자 개념  
  
: 식별자란 하나의 엔터티에 구성되어 있는 여러 개의 속성 중에 엔터티를 대표할 수 있는 속성을 의미하며 하나의 엔터티는 반드시 하나의 유일한 식별자가 존재해야 한다.  
  
2. 식별자의 특징  
  
-   주식별자에 의해 엔터티내에 모든 인스턴스들이 유일하게 구분되어야 한다.
-   주식별자를 구성하는 속성의 수는 유일성을 만족하는 최소의 수가 되어야 한다.
-   지정된 주식별자의 값은 자주 변하지 않는 것이어야 한다.
-   주식별자가 지정이 되면 반드시 값이 들어와야 한다.  
  
3. 식별자 분류 및 표기법  
  
(1) 식별자 분류  
  
- 주식별자 vs 보조식별자 : 대표성을 가지는가
- 내부식별자 vs 외부식별자 : 엔터티 내에서 스스로 생성되었는가
- 단일식별자 vs 복합식별자 : 단일 속성으로 식별이 되는가
- 본질식별자 vs 인조식별자 : 원래 업무적으로 의미가 있던 식별자 속성을 대체하여 일련번호와 같이 새롭게 만든 식별자를 구분  
  
(2) 식별자 표기법  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_052.jpg)  
  
  
4. 주식별자 도출 기준  
  
주식별자를 도출하기 위한 기준을 정리하면 다음과 같다.  
  
-   해당 업무에서 자주 이용되는 속성을 주식별자로 지정한다.  
-   명칭, 내역 등과 같이 이름으로 기술되는 것들은 가능하면 주식별자로 지정하지 않는다.  
-   복합으로 주식별자로 구성할 경우 너무 많은 속성이 포함되지 않도록 한다.  
  
(1) 해당 업무에서 자주 이용되는 속성을 주식별자로 지정하도록 함  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_053.jpg)  
  
(2) 명칭, 내역 등과 같이 이름으로 기술되는 것은 피함  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_054.jpg)  
  
(3) 속성의 수가 많아지지 않도록 함  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_055.jpg)  
  
5. 식별자관계와 비식별자관계에 따른 식별자  
  
(1) 식별자관계와 비식별자 관계의 결정  
:외부식별자(Foreign Identifier)는 자기 자신의 엔터티에서 필요한 속성이 아니라 다른 엔터티와의 관계를 통해 자식 쪽에 엔터티에 생성되는 속성을 외부식별자라 하며 데이터베이스 생성 시에 Foreign Key역할을 한다.  
관계와 속성을 정의하고 주식별자를 정의하면 논리적인 관계에 의해 자연스럽게 외부식별자가 도출되지만 중요하게 고려해야 할 사항이 있다.  
엔터티에 주식별자가 지정되고 엔터티간 관계를 연결하면 부모쪽의 주식별자를 자식엔터티의 속성으로 내려 보낸다.  
이 때 자식엔터티에서 부모엔터티로부터 받은 외부식별자를 자신의 주식별자로 이용할 것인지 또는 부모와 연결이 되는 속성으로서만 이용할 것인지를 결정해야 한다.  
  
(2) 식별자 관계  
:부모로부터 받은 식별자를 자식엔터티의 주식별자로 이용하는 경우는 Null값이 오면 안되므로 반드시 부모엔터티가 생성되어야 자기 자신의 엔터티가 생성되는 경우이다.  
부모로부터 받은 속성을 자식엔터티가 모두 사용하고 그것만으로 주식별자로 사용한다면 부모엔터티와 자식엔터티의 관계는 1:1의 관계가 될 것이고 만약 부모로부터 받은 속성을 포함하여 다른 부모엔터티에서 받은 속성을 포함하거나 스스로 가지고 있는 속성과 함께 주식별자로 구성되는 경우는 1:M 관계가 된다.  
  
(3) 비식별자 관계  
:부모엔터티로부터 속성을 받았지만 자식엔터티의 주식별자로 사용하지 않고 일반적인 속성으로만 사용하는 경우가 있다.  
이과 같은 경우를 비식별자 관계(Non-Identifying Relationship)라고 하며 다음의 네 가지 경우에 비식별자 관계에 의한 외부속성을 생성한다.  
  
1) 자식엔터티에서 받은 속성이 반드시 필수가 아니어도 무방하기 때문에 부모 없는 자식이 생성될 수 있는 경우이다.  
2) 엔터티별로 데이터의 생명주기(Life Cycle)를 다르게 관리할 경우이다. 예를 들어 부모엔터티에 인스턴스가 자식의 엔터티와 관계를 가지고 있었지만 자식만 남겨두고 먼저 소멸될 수 있는 경우가 이에 해당된다. 이에 대한 방안으로 물리데이터베이스 생성 시 Foreign Key를 연결하지 않는 임시적인 방법을 사용하기도 하지만 데이터 모델상에서 관계를 비식별자관계로 조정하는 것이 가장 좋은 방법이다.  
3) 여러 개의 엔터티가 하나의 엔터티로 통합되어 표현되었는데 각각의 엔터티가 별도의 관계를 가질 때이며 이에 해당된다.  
4) 자식엔터티에 주식별자로 사용하여도 되지만 자식엔터티에서 별도의 주식별자를 생성하는 것이 더 유리하다고 판단될 때 비식별자 관계에 의한 외부식별자로 표현한다.  
  
(4) 식별자 관계로만 설정할 경우의 문제점  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_062.jpg)  
  
[그림 Ⅰ-1-50]의 데이터 모델은 원시 엔터티이었던 PLANT의 경우 단지 한 개의 속성만이 PK속성이었으나 EQPEVTSTSHST 엔터티의 경우 부모로부터 모두 식별자관계 연결로 인해 PK속성의 개수가 무려 5개나 설정될 수 밖에 없게 된 사례이다.  
즉, PLANT 엔터티에는 PK속성의 수가 1개이고 관계가 1:M으로 전개되었으므로 자식엔터티는 PLANT 엔터티의 PK속성의 수 + 1이 성립된다. 물론 1개 이상의 속성의 추가되어야 1:M 관계를 만족할 수 있다. 이와 같은 원리에 의해 1:M 관계의 식별자관계의 PK속성의 수는 다음과 같다.  
  
원 부모엔터티 : 1개 2대 부모엔터티 : 2개 이상 = 원부모 1개 + 추가 1개 이상 + 3대 부모엔터티 : 3개 이상 = 원부모 1개 + 2대 1개 + 추가 1개 이상 3대 부모엔터티 : 3개 이상 = 원부모 1개 + 2대 1개 + 3대 1개 + 추가 1개 이상 4대 부모엔터티 : 4개 이상 = 원부모 1개 + 2대 1개 + 3대 1개 + 4 1개 + 추가 1개 이상 ....  
  
이와 같은 규칙에 의해 지속적으로 식별자 관계를 연결한 데이터 모델의 PK속성의 수는 데이터 모델의 흐름이 길어질수록 증가할 수 밖에 없는 구조를 가지게 된다.  
  
(5) 비식별자 관계로만 설정할 경우의 문제점
:일반적으로 각각의 엔터티에는 중요한 기준 속성이 있는데 이러한 기준속성은 부모엔터티에 있는 PK속성으로부터 상속되어 자식엔터티에 존재하는 경우가 많다.   
이런 속성은 부모엔터티를 조회할 때도 당연히 쓰이지만 자식엔터티의 데이터를 조회할 때도 해당 조건이 조회의 조건으로 걸리는 경우가 다수이다.  
그런데 데이터 모델링을 전개할 때 각 엔터티 간의 관계를 비식별자 관계로 설정하면 이런 유형의 속성이 자식엔터티로 상속이 되지 않아 자식엔터티에서 데이터를 처리할 때 쓸데없이 부모엔터티까지 찾아가야 하는 경우가 발생된다.  
  
(6) 식별자관계와 비식별자관계 모델링  
  
1) 비식별자관계 선택 프로세스  
실제로 프로젝트를 전개할 때 식별자관계와 비식별자관계를 취사선택하여 연결하는 내공은 높은 수준의 기술을 요하고 있다. 특히 식별자관계에서 비식별자관계를 파악하는 기술이 필요한데 다음 흐름(Flow)에 따라 비식별자관계를 선정한다면 합리적으로 관계를 설정하는 모습이 될 수 있다. 기본적으로 식별자관계로 모든 관계가 연결되면서 다음 조건에 해당할 경우 비식별자관계로 조정하면 된다.  
  
2) 식별자와 비식별자관계 비교  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_070.jpg)  
  
3) 식별자와 비식별자를 적용한 데이터 모델  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_071.jpg)  
